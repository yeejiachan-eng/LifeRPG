<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>LifeRPG - Ultimate</title>
    
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- 引入像素字體 -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&family=VT323&display=swap" rel="stylesheet">

    <style>
        /* --- 全局設定 --- */
        html, body {
            margin: 0;
            padding: 0;
            background-color: #2d3748; 
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.05) 1px, transparent 1px);
            background-size: 20px 20px;
            
            font-family: 'Noto Sans TC', sans-serif;
            color: #1a202c;
            -webkit-tap-highlight-color: transparent;
            overflow: hidden;
            width: 100%;
            height: 100%;
            position: fixed;
        }

        #root {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
        }

        /* 像素字體 */
        .font-pixel {
            font-family: 'VT323', monospace;
        }

        /* 輸入框 */
        input, select, textarea {
            font-size: 16px !important;
            background-color: #f7fafc;
            border: 1px solid #cbd5e0;
            color: #2d3748;
            border-radius: 4px;
        }
        input:focus, select:focus {
            outline: 2px solid #63b3ed;
            border-color: #63b3ed;
        }

        /* --- RO 風格元件 --- */
        .ro-window {
            background: linear-gradient(to bottom, #f0f4f8, #e2e8f0);
            border: 1px solid #a0aec0;
            border-radius: 6px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.8);
            position: relative;
        }

        .ro-title-bar {
            background: linear-gradient(to bottom, #bfdcf5, #8db2e3);
            border-bottom: 1px solid #7a9bc9;
            color: #1a365d;
            text-shadow: 0 1px 0 rgba(255, 255, 255, 0.5);
            border-radius: 5px 5px 0 0;
            padding: 4px 8px;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .ro-bar-container {
            background: #2d3748;
            border-radius: 9999px;
            padding: 2px;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.5);
            border: 1px solid #4a5568;
        }
        
        .ro-bar-fill {
            background: linear-gradient(to bottom, #8ec5fc 0%, #4a90e2 50%, #2b6cb0 51%, #2c5282 100%);
            border-radius: 9999px;
            position: relative;
            overflow: hidden;
        }
        
        .ro-bar-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 50%;
            background: linear-gradient(to bottom, rgba(255,255,255,0.6), rgba(255,255,255,0.1));
            border-radius: 9999px 9999px 0 0;
        }

        .pb-safe { padding-bottom: env(safe-area-inset-bottom); }
        .pt-safe { padding-top: max(1rem, env(safe-area-inset-top)); }

        .ro-btn-base {
            border: 1px solid transparent;
            box-shadow: 0 1px 2px rgba(0,0,0,0.2);
            transition: all 0.1s;
        }
        .ro-btn-base:active {
            transform: translateY(1px);
            box-shadow: none;
        }
        
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        
        /* 轉職動畫 */
        @keyframes job-change-shine {
            0% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0.7); }
            70% { box-shadow: 0 0 0 20px rgba(255, 215, 0, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0); }
        }
        .animate-job-change {
            animation: job-change-shine 1.5s infinite;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import * as LucideReact from "https://esm.sh/lucide-react@0.263.1?deps=react@18.2.0";

        const { 
            Trophy, Zap, CheckCircle2, Plus, Trash2, Dumbbell, BookOpen, Home, 
            TrendingUp, Lock, Unlock, Star, RefreshCw, X, Briefcase, Heart, 
            Calendar, Clock, Repeat, Download, Filter, HardHat, Info, Settings, Upload, Save, Sword, User, Crown, Sparkles, Gift, Coins, ShoppingBag
        } = LucideReact;

        // --- UI 元件 ---
        
        const Card = ({ children, className = "", title }) => (
            <div className={`ro-window flex flex-col ${className}`}>
                {title && <div className="ro-title-bar flex items-center gap-2">{title}</div>}
                <div className="p-3">
                    {children}
                </div>
            </div>
        );

        const Button = ({ onClick, children, variant = "primary", className = "", disabled = false }) => {
            const variants = {
                primary: "bg-blue-100 hover:bg-blue-200 text-blue-900 border-blue-300",
                secondary: "bg-gray-100 hover:bg-gray-200 text-gray-800 border-gray-300",
                danger: "bg-red-50 hover:bg-red-100 text-red-800 border-red-200",
                outline: "bg-transparent border-slate-400 text-slate-600 hover:bg-slate-100",
                gold: "bg-yellow-100 hover:bg-yellow-200 text-yellow-900 border-yellow-400",
                green: "bg-emerald-100 hover:bg-emerald-200 text-emerald-900 border-emerald-300"
            };
            
            return (
                <button 
                    onClick={onClick}
                    disabled={disabled}
                    className={`ro-btn-base px-3 py-2 rounded text-sm font-bold flex items-center justify-center gap-2 ${variants[variant]} ${className} ${disabled ? 'opacity-50 cursor-not-allowed grayscale' : ''}`}
                >
                    {children}
                </button>
            );
        };

        const ProgressBar = ({ current, max, label, height = "h-4", type = "hp" }) => {
            const percentage = Math.min(100, Math.max(0, (current / max) * 100));
            
            let barColor = 'bg-gradient-to-b from-blue-400 via-blue-500 to-blue-700'; // default SP
            if (type === 'hp') barColor = 'bg-gradient-to-b from-red-400 via-red-500 to-red-700';
            if (type === 'stamina') barColor = 'bg-gradient-to-b from-emerald-400 via-emerald-500 to-emerald-700';

            return (
                <div className="w-full select-none">
                    <div className="ro-bar-container w-full">
                        <div className={`${height} w-full relative`}>
                            <div className="absolute inset-0 w-full h-full bg-slate-800 rounded-full"></div>
                            <div 
                                className={`h-full ro-bar-fill transition-all duration-500 ease-out ${barColor}`}
                                style={{ width: `${percentage}%` }}
                            />
                            <div className="absolute inset-0 flex items-center justify-center z-10">
                                <span className="text-white font-pixel text-[12px] sm:text-[14px] drop-shadow-[0_1px_1px_rgba(0,0,0,1)] tracking-wide">
                                    {Math.floor(current)} / {max}
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const Modal = ({ isOpen, onClose, title, children }) => {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm px-4">
                    <div className="ro-window w-full max-w-sm flex flex-col max-h-[85vh] shadow-2xl animate-slide-up">
                        <div className="ro-title-bar flex justify-between items-center shrink-0">
                            <h3 className="flex items-center gap-2 text-sm"><Info size={14}/> {title}</h3>
                            <button onClick={onClose} className="text-slate-600 hover:text-red-600 hover:bg-white/50 rounded p-0.5"><X size={18} /></button>
                        </div>
                        <div className="p-4 overflow-y-auto bg-[#f7fafc]">
                            {children}
                        </div>
                    </div>
                </div>
            );
        };

        const Notification = ({ message, type, onClose }) => {
            if (!message) return null;
            const styles = {
                success: "bg-emerald-100 text-emerald-800 border-emerald-300",
                error: "bg-red-100 text-red-800 border-red-300",
                info: "bg-blue-100 text-blue-800 border-blue-300",
                gold: "bg-yellow-100 text-yellow-800 border-yellow-300 shadow-[0_0_10px_rgba(250,204,21,0.5)]"
            };
            return (
                <div className={`fixed bottom-24 left-1/2 transform -translate-x-1/2 z-[70] flex items-center justify-between gap-3 px-4 py-2 rounded-lg border shadow-lg w-[90%] max-w-sm ${styles[type] || styles.info}`}>
                    <span className="truncate text-sm font-bold">{message}</span>
                    <button onClick={onClose} className="opacity-60 hover:opacity-100"><X size={16} /></button>
                </div>
            );
        };

        // --- 主程式 ---
        function LifeRPG() {
            const [user, setUser] = React.useState(() => {
                try {
                    const saved = localStorage.getItem('liferpg-user-v2');
                    if (saved) {
                        const parsed = JSON.parse(saved);
                        return { 
                            ...parsed, 
                            name: parsed.name || "Player",
                            jobTitle: parsed.jobTitle || "工程師",
                            zeny: parsed.zeny || 0,
                            stamina: parsed.stamina || { current: 100, max: 100 } 
                        };
                    }
                } catch (e) {
                    console.error("Load Error", e);
                }
                return { 
                    name: "Player",
                    jobTitle: "工程師", 
                    zeny: 0,
                    base: { level: 1, xp: 0, maxXp: 100 }, 
                    job: { level: 1, xp: 0, maxXp: 100 }, 
                    stamina: { current: 100, max: 100 }, 
                    totalTasksCompleted: 0 
                };
            });

            function getWeekNumber(d) {
                d = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));
                d.setUTCDate(d.getUTCDate() + 4 - (d.getUTCDay()||7));
                var yearStart = new Date(Date.UTC(d.getUTCFullYear(),0,1));
                return Math.ceil(( ( (d - yearStart) / 86400000) + 1)/7);
            }

            const calculateMaxXP = (level) => {
                let xp = 100;
                for (let i = 1; i < level; i++) {
                    xp = Math.floor(xp * 1.2);
                }
                return xp;
            };

            const [appState, setAppState] = React.useState(() => {
                const saved = localStorage.getItem('liferpg-app-state');
                return saved ? JSON.parse(saved) : { lastVisitDate: new Date().toDateString(), lastVisitWeek: getWeekNumber(new Date()) };
            });

            const [tasks, setTasks] = React.useState(() => {
                const saved = localStorage.getItem('liferpg-tasks');
                return saved ? JSON.parse(saved) : [
                    { id: 1, title: "遛狗", category: "fitness", xp: 30, money: 50, completed: false, repeat: 'daily' },
                    { id: 2, title: "健身/運動", category: "fitness", xp: 50, money: 100, completed: false, repeat: 'daily' },
                    { id: 3, title: "洗衣服", category: "chores", xp: 40, money: 60, completed: false, repeat: 'weekly' },
                ];
            });

            const [rewards, setRewards] = React.useState(() => {
                const saved = localStorage.getItem('liferpg-rewards-v2');
                return saved ? JSON.parse(saved) : [
                    { id: 1, title: "放縱餐", reqType: 'base', levelReq: 2, cost: 600, currency: 'zeny', unlocked: false },
                    { id: 2, title: "買新遊戲", reqType: 'job', levelReq: 5, cost: 3000, currency: 'zeny', unlocked: false },
                    // 預設加入聖人模式
                    { id: 999, title: "聖人模式 (釋放)", reqType: 'base', levelReq: 1, cost: 100, currency: 'stamina', unlocked: true },
                ];
            });

            const [history, setHistory] = React.useState(() => {
                const saved = localStorage.getItem('liferpg-history');
                return saved ? JSON.parse(saved) : [];
            });

            const [activeTab, setActiveTab] = React.useState('tasks');
            const [questFilter, setQuestFilter] = React.useState('all'); 
            const [levelUpData, setLevelUpData] = React.useState(null);
            const [jobChangeData, setJobChangeData] = React.useState(null); 
            const [notification, setNotification] = React.useState(null); 
            const [showSettings, setShowSettings] = React.useState(false);

            const [newTask, setNewTask] = React.useState({ title: '', category: 'fitness', xp: 20, repeat: 'daily' });
            const [newReward, setNewReward] = React.useState({ title: '', reqType: 'base', levelReq: 2, cost: 100 });
            const [newJobTitle, setNewJobTitle] = React.useState(""); 

            const todayDate = new Date().toLocaleDateString('zh-TW', { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' });

             const categories = {
                fitness: { type: 'base', bg: "bg-red-100 text-red-800", icon: <Dumbbell size={14} />, label: "運動" },
                chores: { type: 'base', bg: "bg-blue-100 text-blue-800", icon: <Home size={14} />, label: "雜務" },
                knowledge: { type: 'job', bg: "bg-purple-100 text-purple-800", icon: <BookOpen size={14} />, label: "知識" },
                finance: { type: 'job', bg: "bg-emerald-100 text-emerald-800", icon: <TrendingUp size={14} />, label: "理財" },
                general: { type: 'base', bg: "bg-gray-100 text-gray-800", icon: <Star size={14} />, label: "一般" },
            };

            const showNotification = (message, type = 'info') => {
                setNotification({ message, type });
                setTimeout(() => setNotification(null), 3000);
            };

            // Effects
            React.useEffect(() => { localStorage.setItem('liferpg-user-v2', JSON.stringify(user)); }, [user]);
            React.useEffect(() => { localStorage.setItem('liferpg-tasks', JSON.stringify(tasks)); }, [tasks]);
            React.useEffect(() => { localStorage.setItem('liferpg-rewards-v2', JSON.stringify(rewards)); }, [rewards]);
            React.useEffect(() => { localStorage.setItem('liferpg-history', JSON.stringify(history)); }, [history]);
            React.useEffect(() => { localStorage.setItem('liferpg-app-state', JSON.stringify(appState)); }, [appState]);

            // Daily Reset Logic (包含 Stamina 回復)
            React.useEffect(() => {
                const today = new Date();
                const todayString = today.toDateString();
                const currentWeek = getWeekNumber(today);
                let updatedTasks = [...tasks];
                let tasksChanged = false;
                
                if (appState.lastVisitDate !== todayString) {
                    // 每日任務重置
                    updatedTasks = updatedTasks.map(t => {
                        if (t.repeat === 'daily' && t.completed) { tasksChanged = true; return { ...t, completed: false }; }
                        return t;
                    });

                    // *** Stamina Daily Regen: 每天 +34 (約3天集滿 36歲養生模式) ***
                    setUser(prev => ({
                        ...prev,
                        stamina: {
                            ...prev.stamina,
                            // Ensure safety
                            max: prev.stamina?.max || 100,
                            current: Math.min((prev.stamina?.max || 100), (prev.stamina?.current || 0) + 34)
                        }
                    }));
                    showNotification("新的一天！精力恢復 +34 (約3天冷卻)", "info");
                }
                
                if (appState.lastVisitWeek !== currentWeek) {
                    updatedTasks = updatedTasks.map(t => {
                        if (t.repeat === 'weekly' && t.completed) { tasksChanged = true; return { ...t, completed: false }; }
                        return t;
                    });
                }
                
                if (tasksChanged) { setTasks(updatedTasks); }
                setAppState({ lastVisitDate: todayString, lastVisitWeek: currentWeek });
            }, []);

            // --- 核心邏輯 ---

            const handleToggleTask = (taskId) => {
                const task = tasks.find(t => t.id === taskId);
                // Hardcore Mode: money = xp * 2
                const taskMoney = task.money !== undefined ? task.money : (task.xp * 2);
                
                if (!task.completed) {
                    // 完成
                    setTasks(tasks.map(t => t.id === taskId ? { ...t, completed: true } : t));
                    setHistory(prev => [{ 
                        logId: Date.now(), 
                        taskId: task.id, 
                        title: task.title, 
                        category: task.category, 
                        xp: task.xp, 
                        money: taskMoney, 
                        completedAt: new Date().toISOString() 
                    }, ...prev]);
                    updateUserStatus(task.xp, task.category, taskMoney);
                    showNotification(`完成！獲得 ${task.xp} XP, $${taskMoney} Z`, "success");

                    const jobKeywords = ["技師", "執照", "License", "轉職", "Job Change", "工程師"];
                    if (jobKeywords.some(keyword => task.title.includes(keyword))) {
                        setTimeout(() => { setNewJobTitle(""); setJobChangeData(task.title); }, 800); 
                    }
                } else {
                    // Undo
                    setTasks(tasks.map(t => t.id === taskId ? { ...t, completed: false } : t));
                    setHistory(prev => {
                        const index = prev.findIndex(h => h.taskId === task.id || h.title === task.title);
                        if (index > -1) {
                            const newHistory = [...prev];
                            newHistory.splice(index, 1);
                            return newHistory;
                        }
                        return prev;
                    });
                    updateUserStatus(-task.xp, task.category, -taskMoney);
                    showNotification("已復原 (回收 XP & Zeny)", "info");
                }
            };

            // 兌換獎勵 (支援 Zeny 和 Stamina)
            const handleRedeemReward = (reward) => {
                const cost = reward.cost || 0;
                const currency = reward.currency || 'zeny';

                if (currency === 'zeny') {
                    if (user.zeny < cost) {
                        showNotification("Zeny 不足！", "error");
                        return;
                    }
                    updateUserStatus(0, "general", -cost);
                    showNotification(`已兌換 ${reward.title} (-$${cost} Z)`, "gold");
                } 
                else if (currency === 'stamina') {
                    if ((user.stamina?.current || 0) < cost) {
                        // No prompt, just block
                        showNotification("精力不足！休息一下吧", "error");
                        return;
                    } else {
                        setUser(prev => ({
                            ...prev,
                            stamina: { ...prev.stamina, current: prev.stamina.current - cost }
                        }));
                        showNotification(`聖人模式 (-${cost} STA)`, "success");
                    }
                }
                
                setHistory(prev => [{ 
                    logId: Date.now(), 
                    title: `兌換: ${reward.title}`, 
                    category: "general", 
                    xp: 0, 
                    money: currency === 'zeny' ? -cost : 0,
                    isReward: true,
                    completedAt: new Date().toISOString() 
                }, ...prev]);
            };

            const confirmJobChange = () => {
                if (!newJobTitle.trim()) return;
                setUser(prev => ({ ...prev, jobTitle: newJobTitle }));
                setJobChangeData(null);
                showNotification(`轉職成功！${newJobTitle}`, "gold");
            };

            // 統一的狀態更新函式
            const updateUserStatus = (xpAmount, categoryKey, moneyAmount) => {
                const category = categories[categoryKey] || categories.general;
                const type = category.type;
                
                setUser(prev => {
                    let currentStats = { ...prev[type] };
                    let newXP = currentStats.xp + xpAmount;
                    let newLevel = currentStats.level;
                    let newMaxXp = currentStats.maxXp;
                    let newZeny = Math.max(0, (prev.zeny || 0) + moneyAmount); 
                    
                    let leveledUp = false;
                    let totalCompletedChange = xpAmount > 0 ? 1 : -1;
                    if (xpAmount === 0) totalCompletedChange = 0;

                    if (xpAmount > 0) {
                        while (newXP >= newMaxXp) {
                            newXP -= newMaxXp;
                            newLevel++;
                            newMaxXp = Math.floor(newMaxXp * 1.2);
                            leveledUp = true;
                        }
                    } 
                    else if (xpAmount < 0) {
                        while (newXP < 0) {
                            if (newLevel > 1) {
                                newLevel--;
                                newMaxXp = calculateMaxXP(newLevel);
                                newXP += newMaxXp; 
                            } else {
                                newXP = 0; 
                                break; 
                            }
                        }
                    }

                    if (leveledUp) { setTimeout(() => setLevelUpData({ type, level: newLevel }), 100); }
                    
                    return { 
                        ...prev, 
                        zeny: newZeny,
                        [type]: { level: newLevel, xp: newXP, maxXp: newMaxXp }, 
                        totalTasksCompleted: Math.max(0, prev.totalTasksCompleted + totalCompletedChange) 
                    };
                });
            };

            const handleManualReset = () => {
                if(window.confirm("重置所有每日任務？")) { setTasks(tasks.map(t => ({ ...t, completed: false }))); showNotification("已重置", "info"); setShowSettings(false); }
            };
            const handleDeleteTask = (id) => { setTasks(tasks.filter(t => t.id !== id)); showNotification("已刪除", "error"); };
            const handleAddTask = (e) => {
                e.preventDefault();
                if (!newTask.title.trim()) return;
                const moneyVal = parseInt(newTask.xp) * 2;
                setTasks([...tasks, { 
                    id: Date.now(), 
                    title: newTask.title, 
                    category: newTask.category, 
                    xp: parseInt(newTask.xp), 
                    money: moneyVal,
                    repeat: newTask.repeat, 
                    completed: false 
                }]);
                setNewTask({ title: '', category: 'fitness', xp: 20, repeat: 'daily' });
                showNotification("新增成功", "success");
            };
            const handleAddReward = (e) => {
                e.preventDefault();
                if (!newReward.title.trim()) return;
                setRewards([...rewards, { 
                    id: Date.now(), 
                    title: newReward.title, 
                    reqType: newReward.reqType, 
                    levelReq: parseInt(newReward.levelReq), 
                    cost: parseInt(newReward.cost || 0),
                    currency: newReward.currency || 'zeny',
                    unlocked: false 
                }]);
                setNewReward(prev => ({ ...prev, title: '', cost: 100, currency: 'zeny' })); 
                showNotification("新增獎勵", "success");
            };
            const handleDeleteReward = (id) => { setRewards(rewards.filter(r => r.id !== id)); };
            const handleClearHistory = () => { if(window.confirm("清除紀錄？")) { setHistory([]); showNotification("紀錄已清除", "info"); setShowSettings(false); } };

            const handleExportData = () => {
                const data = { user, tasks, rewards, history, appState, version: "2.4" };
                const blob = new Blob([JSON.stringify(data)], { type: "application/json" });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `liferpg_backup.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                showNotification("備份已下載", "success");
            };

            const handleImportData = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = JSON.parse(e.target.result);
                        if(data.user) setUser({...data.user, name: data.user.name || "Player", jobTitle: data.user.jobTitle || "工程師", zeny: data.user.zeny || 0, stamina: data.user.stamina || {current:100, max:100}});
                        if(data.tasks) setTasks(data.tasks);
                        if(data.rewards) setRewards(data.rewards);
                        if(data.history) setHistory(data.history);
                        if(data.appState) setAppState(data.appState);
                        showNotification("還原成功", "success");
                        setShowSettings(false);
                    } catch (err) {
                        showNotification("檔案格式錯誤", "error");
                    }
                };
                reader.readAsText(file);
            };

            // --- 匯入包邏輯 ---

            const handleImportStarterPack = () => {
                mergePack([
                    { id: 1001, title: "遛狗", category: "fitness", xp: 30, money: 50, repeat: 'daily' }, 
                    { id: 1002, title: "運動", category: "fitness", xp: 50, money: 100, repeat: 'daily' },
                    { id: 1008, title: "喝水 2000cc", category: "fitness", xp: 10, money: 15, repeat: 'daily' }, 
                    { id: 1009, title: "檢視開銷", category: "finance", xp: 20, money: 30, repeat: 'daily' }
                ], "新手包");
            };

            const handleImportEngineerPack = () => {
                mergePack([
                    { id: 2001, title: "考取環工技師執照 (PE)", category: "knowledge", xp: 100, money: 2000, repeat: 'none' }, 
                    { id: 2004, title: "番茄鐘環評 (4x25m)", category: "knowledge", xp: 20, money: 40, repeat: 'daily' },
                    { id: 2006, title: "零支出挑戰", category: "finance", xp: 30, money: 60, repeat: 'daily' }, 
                    { id: 2008, title: "轉帳工程款", category: "finance", xp: 50, money: 200, repeat: 'weekly' }
                ], "環工包");
            };

            const handleImportUpgradePack = () => {
                mergePack([
                    { id: 3003, title: "更新履歷/作品集", category: "knowledge", xp: 50, money: 200, repeat: 'none' },
                    { id: 3004, title: "核對信用卡帳單", category: "finance", xp: 20, money: 40, repeat: 'weekly' },
                    { id: 3005, title: "查詢房貸利率/政策", category: "finance", xp: 20, money: 40, repeat: 'weekly' },
                    { id: 3006, title: "收集裝潢靈感 (Pinterest)", category: "general", xp: 15, money: 30, repeat: 'weekly' },
                    { id: 3007, title: "護眼熱敷 10 分鐘", category: "fitness", xp: 10, money: 15, repeat: 'daily' },
                    { id: 3008, title: "斷捨離：丟掉 3 樣雜物", category: "chores", xp: 20, money: 30, repeat: 'weekly' },
                    { id: 3009, title: "伴侶約會日 (禁談公事)", category: "general", xp: 50, money: 100, repeat: 'weekly' },
                    { id: 3010, title: "辦公室肩頸伸展", category: "fitness", xp: 15, money: 20, repeat: 'daily' },
                    { id: 3011, title: "研讀環工英文/最新法規", category: "knowledge", xp: 30, money: 50, repeat: 'weekly' },
                    { id: 3012, title: "預售屋家電/家具比價", category: "finance", xp: 20, money: 40, repeat: 'weekly' },
                    { id: 3013, title: "整理電腦檔案/圖資", category: "chores", xp: 20, money: 40, repeat: 'weekly' }
                ], "升級包");
            };

            const mergePack = (pack, name) => {
                const currentTasks = Array.isArray(tasks) ? tasks : [];
                const newT = pack.filter(n => !currentTasks.some(e => e.title.trim() === n.title.trim())).map(t => ({...t, id: Date.now() + Math.random(), completed: false}));
                
                if (newT.length === 0) { 
                    showNotification("任務已存在", "info"); 
                    return; 
                }
                setTasks(p => [...p, ...newT]);
                showNotification(`已匯入 ${name}`, "success");
            }

            const handleImportRewardPack = () => {
                const rewardPack = [
                    { id: 4001, title: "無罪惡感打電動 1小時", reqType: 'base', levelReq: 1, cost: 150, currency: 'zeny', unlocked: false },
                    { id: 4002, title: "喝一杯手搖飲 (加料!)", reqType: 'base', levelReq: 3, cost: 80, currency: 'zeny', unlocked: false },
                    { id: 4004, title: "週末睡到自然醒", reqType: 'base', levelReq: 2, cost: 200, currency: 'zeny', unlocked: false },
                    { id: 4005, title: "網購平價內褲 (1件)", reqType: 'job', levelReq: 2, cost: 800, currency: 'zeny', unlocked: false },
                    { id: 4006, title: "Steam/遊戲課金 ($500內)", reqType: 'job', levelReq: 4, cost: 3000, currency: 'zeny', unlocked: false },
                    { id: 4007, title: "專櫃/高質感內褲 (1件)", reqType: 'job', levelReq: 7, cost: 3500, currency: 'zeny', unlocked: false },
                    { id: 4009, title: "奢華成套內衣褲 (全套)", reqType: 'job', levelReq: 15, cost: 6000, currency: 'zeny', unlocked: false },
                    { id: 4010, title: "新家軟裝小物 ($1000內)", reqType: 'job', levelReq: 6, cost: 5000, currency: 'zeny', unlocked: false },
                    { id: 999, title: "聖人模式 (釋放)", reqType: 'base', levelReq: 1, cost: 100, currency: 'stamina', unlocked: true }
                ];

                const currentRewards = Array.isArray(rewards) ? rewards : [];
                const newR = rewardPack.filter(n => !currentRewards.some(e => e.title && e.title.trim() === n.title.trim())).map(r => ({...r, id: Date.now() + Math.random()}));

                if (newR.length === 0) {
                    showNotification("獎勵已存在", "info");
                    return;
                }
                setRewards(p => [...p, ...newR]);
                showNotification(`成功匯入獎勵包`, "success");
            };

            const getHistoryByDate = () => {
                const groups = {};
                history.forEach(entry => {
                    const date = new Date(entry.completedAt).toLocaleDateString('zh-TW', { month: 'short', day: 'numeric', weekday: 'short' });
                    if (!groups[date]) groups[date] = [];
                    groups[date].push(entry);
                });
                return groups;
            };

            const filteredTasks = tasks.filter(task => {
                if (questFilter === 'all') return true;
                const cat = categories[task.category] || categories.general;
                return cat.type === questFilter;
            });

            return (
                <div className="w-full min-h-full flex flex-col text-sm">
                    {notification && <Notification message={notification.message} type={notification.type} onClose={() => setNotification(null)} />}

                    {/* Header (RO Basic Info Window) */}
                    <div className="sticky top-0 z-30 w-full pt-safe px-3 pb-2 shrink-0" style={{background: '#2d3748'}}>
                        <div className="ro-window p-3 space-y-2 max-w-lg mx-auto">
                            <div className="flex items-start justify-between border-b border-slate-300 pb-1 mb-1">
                                <div className="flex flex-col">
                                    <h1 className="text-base font-bold text-blue-900 flex items-center gap-2">
                                        Basic Information
                                    </h1>
                                </div>
                                <div className="flex items-center gap-2">
                                    {/* Zeny Display */}
                                    <div className="bg-white/80 border border-slate-400 rounded px-2 py-0.5 text-xs font-pixel flex items-center gap-1">
                                        <span className="text-yellow-600 font-bold">Z</span>
                                        <span>{user.zeny || 0}</span>
                                    </div>
                                    <button onClick={() => setShowSettings(true)} className="text-slate-500 hover:text-blue-600">
                                        <Settings size={16} />
                                    </button>
                                </div>
                            </div>
                            
                            <div className="flex justify-between items-end px-1">
                                <div>
                                    <div className="text-sm font-bold text-slate-800">{user.name}</div>
                                    <div className="text-xs font-bold text-blue-700 flex items-center gap-1">
                                        <Crown size={12} className="text-yellow-500" />
                                        {user.jobTitle}
                                    </div>
                                </div>
                                <div className="text-[10px] text-slate-500 font-pixel text-right">
                                    {todayDate}
                                </div>
                            </div>

                            <div className="flex items-center gap-2">
                                <span className="text-xs font-bold text-slate-700 w-14 shrink-0">Base Lv.</span>
                                <ProgressBar current={user.base.xp} max={user.base.maxXp} height="h-3" />
                                <span className="text-xs font-bold w-8 text-right font-pixel">{user.base.level}</span>
                            </div>

                            <div className="flex items-center gap-2">
                                <span className="text-xs font-bold text-slate-700 w-14 shrink-0">Job Lv.</span>
                                <ProgressBar current={user.job.xp} max={user.job.maxXp} height="h-3" />
                                <span className="text-xs font-bold w-8 text-right font-pixel">{user.job.level}</span>
                            </div>

                            {/* Stamina Bar */}
                             <div className="flex items-center gap-2">
                                <span className="text-xs font-bold text-emerald-700 w-14 shrink-0">STA</span>
                                <ProgressBar current={user.stamina?.current || 0} max={user.stamina?.max || 100} height="h-3" type="stamina" />
                                <span className="text-xs font-bold w-8 text-right font-pixel">{Math.floor(user.stamina?.current || 0)}</span>
                            </div>
                        </div>
                    </div>

                    {/* Main Content */}
                    <main className="flex-1 w-full max-w-lg mx-auto p-3 pb-32 overflow-x-hidden">
                        
                        <div className="grid grid-cols-3 gap-2 mb-4 w-full">
                            <button onClick={() => setActiveTab('tasks')} className={`ro-btn-base py-2 rounded text-xs font-bold flex items-center justify-center gap-1 ${activeTab === 'tasks' ? 'bg-blue-200 text-blue-900 border-blue-400' : 'bg-white text-slate-600 border-slate-300'}`}>
                                <CheckCircle2 size={14} /> 任務
                            </button>
                            <button onClick={() => setActiveTab('rewards')} className={`ro-btn-base py-2 rounded text-xs font-bold flex items-center justify-center gap-1 ${activeTab === 'rewards' ? 'bg-amber-200 text-amber-900 border-amber-400' : 'bg-white text-slate-600 border-slate-300'}`}>
                                <ShoppingBag size={14} /> 商店
                            </button>
                            <button onClick={() => setActiveTab('history')} className={`ro-btn-base py-2 rounded text-xs font-bold flex items-center justify-center gap-1 ${activeTab === 'history' ? 'bg-teal-200 text-teal-900 border-teal-400' : 'bg-white text-slate-600 border-slate-300'}`}>
                                <Calendar size={14} /> 紀錄
                            </button>
                        </div>

                        {activeTab === 'tasks' && (
                            <div className="space-y-4 animate-slide-in">
                                <div className="flex justify-center gap-2 mb-2">
                                    <button onClick={() => setQuestFilter('all')} className={`px-3 py-1 rounded-full text-[10px] font-bold border ${questFilter === 'all' ? 'bg-blue-600 text-white border-blue-700' : 'bg-white text-slate-500 border-slate-300'}`}>全部</button>
                                    <button onClick={() => setQuestFilter('base')} className={`px-3 py-1 rounded-full text-[10px] font-bold border ${questFilter === 'base' ? 'bg-red-500 text-white border-red-600' : 'bg-white text-slate-500 border-slate-300'}`}>生活 (Base)</button>
                                    <button onClick={() => setQuestFilter('job')} className={`px-3 py-1 rounded-full text-[10px] font-bold border ${questFilter === 'job' ? 'bg-blue-500 text-white border-blue-600' : 'bg-white text-slate-500 border-slate-300'}`}>職涯 (Job)</button>
                                </div>

                                <Card title="Quest Board">
                                    <div className="flex flex-col gap-2">
                                        <input type="text" placeholder="新任務..." className="w-full px-2 py-1.5" value={newTask.title} onChange={(e) => setNewTask({...newTask, title: e.target.value})} />
                                        <div className="grid grid-cols-2 gap-2">
                                            <select className="px-1 py-1.5 text-xs" value={newTask.category} onChange={(e) => setNewTask({...newTask, category: e.target.value})}>
                                                {Object.entries(categories).map(([key, val]) => <option key={key} value={key}>{val.label}</option>)}
                                            </select>
                                            <select className="px-1 py-1.5 text-xs" value={newTask.repeat} onChange={(e) => setNewTask({...newTask, repeat: e.target.value})}>
                                                <option value="daily">每日</option>
                                                <option value="weekly">每週</option>
                                                <option value="none">一次</option>
                                            </select>
                                        </div>
                                        <div className="flex gap-2">
                                             <select className="flex-1 px-1 py-1.5 text-xs" value={newTask.xp} onChange={(e) => setNewTask({...newTask, xp: e.target.value})}>
                                                <option value="10">10 XP ($20Z)</option>
                                                <option value="20">20 XP ($40Z)</option>
                                                <option value="30">30 XP ($60Z)</option>
                                                <option value="50">50 XP ($100Z)</option>
                                            </select>
                                            <Button variant="primary" onClick={handleAddTask} className="flex-1 text-xs"><Plus size={14} /> 接受</Button>
                                        </div>
                                    </div>
                                </Card>

                                <div className="flex flex-wrap justify-end gap-2">
                                    <button onClick={handleImportUpgradePack} className="ro-btn-base px-2 py-1.5 rounded text-xs font-bold flex items-center gap-1 bg-slate-700 text-yellow-300 border border-slate-600 hover:bg-slate-600"><Sparkles size={12} /> 升級包</button>
                                    <button onClick={handleImportEngineerPack} className="ro-btn-base px-2 py-1.5 rounded text-xs font-bold flex items-center gap-1 bg-slate-700 text-cyan-300 border border-slate-600 hover:bg-slate-600"><HardHat size={12} /> 環工包</button>
                                    <button onClick={handleImportStarterPack} className="ro-btn-base px-2 py-1.5 rounded text-xs font-bold flex items-center gap-1 bg-slate-700 text-indigo-300 border border-slate-600 hover:bg-slate-600"><Download size={12} /> 新手包</button>
                                </div>

                                <div className="space-y-2">
                                    {filteredTasks.length === 0 && <div className="text-center py-8 text-slate-400 text-xs">無任務</div>}
                                    {filteredTasks.sort((a,b) => (a.completed === b.completed) ? 0 : a.completed ? 1 : -1).map((task) => {
                                        const cat = categories[task.category] || categories.general;
                                        const xpType = cat.type === 'base' ? 'Base' : 'Job';
                                        // 顯示 Zeny 獎勵 (如果有的話)
                                        const moneyReward = task.money || (task.xp * 2);
                                        return (
                                            <div key={task.id} className={`relative flex items-center justify-between p-3 ro-window ${task.completed ? 'opacity-60 bg-gray-200' : 'bg-white'}`}>
                                                <div className="flex items-center gap-3 flex-1 min-w-0">
                                                    <button 
                                                        onClick={() => handleToggleTask(task.id)} 
                                                        className={`shrink-0 h-6 w-6 rounded shadow-sm flex items-center justify-center border transition-all active:scale-95 ${task.completed ? 'bg-green-100 border-green-300 text-green-600' : 'bg-white border-slate-300 text-slate-300 hover:border-blue-400'}`}
                                                    >
                                                        {task.completed && <CheckCircle2 size={14} />}
                                                    </button>
                                                    <div className="min-w-0 flex-1">
                                                        <div className="flex items-center gap-2 mb-0.5">
                                                            <span className={`text-[9px] px-1 rounded border ${cat.bg} flex items-center gap-1`}>{cat.icon} {cat.label}</span>
                                                            <span className="text-[10px] font-pixel text-slate-500">+{task.xp} {xpType}</span>
                                                            <span className="text-[10px] font-pixel text-yellow-600 bg-yellow-50 px-1 rounded border border-yellow-200">+${moneyReward} Z</span>
                                                        </div>
                                                        <h3 className={`font-bold text-sm truncate ${task.completed ? 'line-through text-slate-400' : 'text-slate-800'}`}>{task.title}</h3>
                                                    </div>
                                                </div>
                                                <button onClick={() => handleDeleteTask(task.id)} className="ml-2 text-slate-400 hover:text-red-500"><Trash2 size={14} /></button>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        )}

                        {/* Rewards Tab (Shop Style) */}
                        {activeTab === 'rewards' && (
                            <div className="space-y-4 animate-slide-in">
                                <Card title="Item Shop">
                                    <div className="flex flex-col gap-2">
                                        <input type="text" placeholder="商品名稱..." className="w-full px-2 py-1.5" value={newReward.title} onChange={(e) => setNewReward({...newReward, title: e.target.value})} />
                                        <div className="grid grid-cols-2 gap-2">
                                            <select className="col-span-1 px-1 py-1.5 text-xs" value={newReward.reqType} onChange={(e) => setNewReward({...newReward, reqType: e.target.value})}>
                                                <option value="base">Req: Base Lv</option>
                                                <option value="job">Req: Job Lv</option>
                                            </select>
                                            <input type="number" placeholder="等級需求" className="col-span-1 px-2 py-1.5" value={newReward.levelReq} onChange={(e) => setNewReward({...newReward, levelReq: e.target.value})} />
                                        </div>
                                        <div className="flex gap-2">
                                            <input type="number" placeholder="價格 ($Z)" className="flex-1 px-2 py-1.5" value={newReward.cost || ''} onChange={(e) => setNewReward({...newReward, cost: e.target.value})} />
                                            <select className="w-20 px-1 py-1.5 text-xs" value={newReward.currency} onChange={(e) => setNewReward({...newReward, currency: e.target.value})}>
                                                <option value="zeny">Zeny</option>
                                                <option value="stamina">STA</option>
                                            </select>
                                            <Button variant="primary" onClick={handleAddReward} className="text-xs"><Plus size={14} /> 上架</Button>
                                        </div>
                                    </div>
                                </Card>

                                <div className="flex justify-end">
                                    <button onClick={handleImportRewardPack} className="ro-btn-base px-2 py-1.5 rounded text-xs font-bold flex items-center gap-1 bg-slate-700 text-pink-300 border border-slate-600 hover:bg-slate-600"><Gift size={12} /> 獎勵包</button>
                                </div>

                                <div className="grid grid-cols-1 gap-2">
                                    {rewards.sort((a,b) => {
                                        // 排序邏輯：Zeny 在前，Stamina 在後，然後按價格排序
                                        if (a.currency === b.currency) return (a.cost || 0) - (b.cost || 0);
                                        return a.currency === 'stamina' ? 1 : -1;
                                    }).map((reward) => {
                                        const isUnlocked = (reward.reqType === 'base' ? user.base.level : user.job.level) >= reward.levelReq;
                                        const cost = reward.cost || 0;
                                        const currency = reward.currency || 'zeny';
                                        const canAfford = currency === 'zeny' ? (user.zeny || 0) >= cost : (user.stamina?.current || 0) >= cost;
                                        
                                        return (
                                            <div key={reward.id} className={`relative p-3 ro-window flex items-center justify-between ${isUnlocked ? 'bg-white' : 'bg-gray-200 opacity-80'}`}>
                                                <div className="flex items-center gap-3">
                                                    <div className={`p-1.5 rounded ${isUnlocked ? (currency === 'stamina' ? 'text-emerald-600 bg-emerald-100' : 'text-blue-600 bg-blue-100') : 'text-slate-400 bg-slate-200'}`}>
                                                        {isUnlocked ? <ShoppingBag size={16} /> : <Lock size={16} />}
                                                    </div>
                                                    <div>
                                                        <h3 className="font-bold text-sm text-slate-700">{reward.title}</h3>
                                                        <div className="flex items-center gap-2 text-[10px]">
                                                            <span className={`font-pixel ${isUnlocked ? (canAfford ? (currency === 'stamina' ? 'text-emerald-600 font-bold' : 'text-yellow-600 font-bold') : 'text-red-500') : 'text-slate-400'}`}>
                                                                {currency === 'stamina' ? `${cost} STA` : `$${cost} Z`}
                                                            </span>
                                                            {!isUnlocked && <span className="text-red-400">Req: Lv.{reward.levelReq}</span>}
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                {isUnlocked ? (
                                                    <Button 
                                                        onClick={() => handleRedeemReward(reward)} 
                                                        variant={canAfford ? (currency === 'stamina' ? "primary" : "green") : "outline"} 
                                                        disabled={!canAfford && currency === 'zeny'} // STA 允許透支確認
                                                        className="text-xs py-1 px-2"
                                                    >
                                                        購買
                                                    </Button>
                                                ) : (
                                                    <button onClick={() => handleDeleteReward(reward.id)} className="text-slate-400 hover:text-red-500"><Trash2 size={14} /></button>
                                                )}
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        )}

                        {/* History Tab */}
                        {activeTab === 'history' && (
                             <div className="space-y-4 animate-slide-in">
                                <div className="flex justify-between items-center px-1">
                                    <h2 className="text-xs font-bold text-slate-400 uppercase">Adventure Log</h2>
                                    <button onClick={handleClearHistory} className="text-[10px] text-slate-500 hover:text-red-500 flex items-center gap-1"><Trash2 size={10} /> 清除</button>
                                </div>
                                {history.length === 0 ? <div className="text-center py-12 text-slate-400 text-xs">無紀錄</div> : (
                                    <div className="space-y-4 relative before:absolute before:left-3 before:top-2 before:bottom-2 before:w-px before:bg-slate-600">
                                        {Object.entries(getHistoryByDate()).map(([date, entries]) => (
                                            <div key={date} className="relative pl-8">
                                                <div className="absolute left-1.5 top-0 w-3 h-3 bg-slate-500 rounded-full border border-slate-400 transform -translate-x-1/2 z-10"></div>
                                                <div className="mb-2"><span className="text-[10px] font-bold text-slate-300 bg-slate-600 px-2 py-0.5 rounded">{date}</span></div>
                                                <div className="space-y-1.5">
                                                    {entries.map(entry => (
                                                        <div key={entry.logId} className="bg-white/90 border border-slate-300 p-2 rounded flex items-center justify-between shadow-sm">
                                                            <div className="flex flex-col overflow-hidden">
                                                                <span className={`text-xs font-bold truncate ${entry.isReward ? 'text-purple-700' : 'text-slate-700'}`}>{entry.title}</span>
                                                                <span className="text-[9px] text-slate-400">{new Date(entry.completedAt).toLocaleTimeString('zh-TW', {hour:'2-digit', minute:'2-digit'})}</span>
                                                            </div>
                                                            <div className="flex flex-col items-end shrink-0">
                                                                {entry.xp !== 0 && <span className={`text-[10px] font-pixel ${entry.xp > 0 ? 'text-blue-600' : 'text-red-500'}`}>{entry.xp > 0 ? '+' : ''}{entry.xp} XP</span>}
                                                                {entry.money !== 0 && <span className={`text-[10px] font-pixel ${entry.money > 0 ? 'text-yellow-600' : 'text-red-500'}`}>{entry.money > 0 ? '+' : ''}${entry.money} Z</span>}
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        )}
                    </main>

                    {/* Settings Modal */}
                    <Modal isOpen={showSettings} onClose={() => setShowSettings(false)} title="System">
                        <div className="space-y-4 w-full">
                            <div className="bg-white p-3 rounded border border-slate-300 space-y-2">
                                <h4 className="text-[10px] font-bold text-slate-500 uppercase">Data</h4>
                                <div className="flex gap-2">
                                    <Button onClick={handleExportData} className="flex-1 text-xs"><Save size={14} /> 存檔</Button>
                                    <label className="flex-1 ro-btn-base px-3 py-2 rounded text-xs font-bold flex items-center justify-center gap-2 bg-gray-100 text-gray-800 border-gray-300 cursor-pointer hover:bg-gray-200">
                                        <Upload size={14} /> 讀檔
                                        <input type="file" accept=".json" className="hidden" onChange={handleImportData} />
                                    </label>
                                </div>
                            </div>
                            
                            <div className="bg-white p-3 rounded border border-slate-300 space-y-2">
                                <h4 className="text-[10px] font-bold text-slate-500 uppercase">Change Job</h4>
                                <div className="flex gap-2">
                                    <input 
                                        type="text" 
                                        placeholder="手動輸入新職業..." 
                                        className="flex-1 px-2 py-1 text-xs"
                                        value={newJobTitle}
                                        onChange={(e) => setNewJobTitle(e.target.value)}
                                    />
                                    <Button onClick={confirmJobChange} variant="gold" className="text-xs">變更</Button>
                                </div>
                            </div>

                            <div className="bg-white p-3 rounded border border-slate-300 space-y-2">
                                <h4 className="text-[10px] font-bold text-slate-500 uppercase">Reset</h4>
                                <div className="grid grid-cols-1 gap-2">
                                    <Button onClick={handleManualReset} variant="secondary" className="text-xs"><RefreshCw size={14} /> 重置每日任務</Button>
                                    <Button onClick={handleClearHistory} variant="danger" className="text-xs"><Trash2 size={14} /> 清除紀錄</Button>
                                </div>
                            </div>
                        </div>
                    </Modal>

                    {/* Level Up Modal */}
                    <Modal isOpen={!!levelUpData} onClose={() => setLevelUpData(null)} title="LEVEL UP!">
                        <div className="text-center space-y-4 py-4">
                            <div className="mx-auto h-20 w-20 rounded-full bg-yellow-100 flex items-center justify-center animate-bounce text-yellow-600 border-4 border-yellow-200">
                                <img src="https://api.iconify.design/mdi:wings.svg?color=goldenrod" className="w-12 h-12" alt="wings" />
                            </div>
                            <div>
                                <h2 className="text-3xl font-pixel text-blue-800">LV {levelUpData?.level}</h2>
                                <p className="text-sm text-slate-300 mt-1">Congratulations!</p>
                            </div>
                            <Button onClick={() => setLevelUpData(null)} variant="primary" className="w-full mt-2">Confirm</Button>
                        </div>
                    </Modal>

                    {/* Job Change Modal */}
                    <Modal isOpen={!!jobChangeData} onClose={() => setJobChangeData(null)} title="JOB CHANGE!">
                        <div className="text-center space-y-4 py-4">
                            <div className="mx-auto h-24 w-24 rounded-full bg-gradient-to-b from-yellow-300 to-yellow-500 flex items-center justify-center animate-job-change border-4 border-white shadow-lg">
                                <Crown size={48} className="text-white drop-shadow-md" />
                            </div>
                            <div>
                                <h2 className="text-xl font-bold text-blue-900">完成: {jobChangeData}</h2>
                                <p className="text-sm text-slate-600 mt-2">您已具備轉職資格！請輸入新職業：</p>
                                <input 
                                    type="text" 
                                    placeholder="例如: 資深環工技師" 
                                    className="w-full mt-3 px-3 py-2 text-center font-bold text-lg border-2 border-yellow-400 focus:border-yellow-600 rounded"
                                    value={newJobTitle}
                                    onChange={(e) => setNewJobTitle(e.target.value)}
                                />
                            </div>
                            <Button onClick={confirmJobChange} variant="gold" className="w-full mt-2 py-3 text-base">確認轉職</Button>
                        </div>
                    </Modal>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<LifeRPG />);
    </script>
</body>
</html>
